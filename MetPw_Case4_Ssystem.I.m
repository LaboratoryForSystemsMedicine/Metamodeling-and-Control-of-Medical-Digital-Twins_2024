
Par=[0,0,0,0,0,0                                              %1
    5.182e-07    1.6433   -0.0390   -0.1024   -0.2732    0.0182  %2
    5.182e-07    1.6433   -0.0390   -0.1024   -0.2732    0.0182  %3
    0.0000610814439018989   -0.0000    0.5543    0.51689    0.0327    0.1049  %4
    0.00210814439018989   -0.0200    0.9543   -0.3080    0.0327    0.1049  %5
    0.000699018377490511   -0.1117   -0.2320    1.1689   -0.0673   -0.0101  %6
    0.000699018377490511   -0.1117   -0.2320    1.1689   -0.0673   -0.0101  %7
    0,0,0,0,0,0                                              %8
    3.11616497220864e-06    0.1213    1.0482   -0.0737    0.3804    0.1408 %9
    0,0,0,0,0,0                                              %10
    ];

Par=[-9.54282606219913e-05*0;5.13851789005299e-07;4.93036997151627e-07;6.10649865573412e-05;0.00229047893537440;0.000708724144653862;0.000674607705120644;-0.000136683518876926;3.13640452660424e-06;6.18007510528325e-05;5.32831839963998e-05;1.64960407182183;1.59251754102807;-0.000297752065009892;-0.0201164993747569;-0.114539107026625;-0.104908664451582;4.96605845687030e-05;0.122159486487827;1.61631704382400e-05;2.69825362145731e-05;-0.0388931482718847;-0.0370569103368439;0.548612748325725;0.902946607797326;-0.222407536470319;-0.229370745902107;8.01592029917285e-05;1.04283489368102;-8.85492705794544e-05;-5.37098245475649e-05;-0.104935974584753;-0.103936283690092;0.503823355177374;-0.327009981958830;1.19459884707677;1.16843035660177;-0.000128117874515733;-0.0724636682272648;-0.000104690556428115;-2.50769807357367e-05;-0.275896200138763;-0.281729488532596;0.0298766283435150;0.0321215588815507;-0.0953123133291650;-0.0646352484445844;2.58369936247469e-05;0.358126679844696;-3.82708110416080e-05;8.10321201756347e-05;0.0178056966289258;0.0182223662724751;0.104187897522646;0*0.116135736146784;-0.0100894408402053;-0.00956960437648766;0.000132299427125628;0.140747180044943;3.23710846569111e-05]
Par=[9.71063921931315e-05*0;5.22119194793771e-07;5.14644486894940e-07;6.10950818903621e-05;0.00243305076039757;0.000646303509907829;0.000718425466428024;-0.000140013446055933;3.62491435009082e-06;6.30778466572674e-05;5.04149410968653e-05;1.64770604264026;1.59519671610663;-0.000294506070706587;-0.0197582415206072;-0.111596213650983;-0.105244755584085;4.96297547955408e-05;0.116754008531441;1.43154398191009e-05;3.09398096764458e-05;-0.0412717625382417;-0.0360770974336747;0.583188264441731;0.963856384785012;-0.218143095832488;-0.227388337004475;8.36207634184974e-05;1.05477453380608;-7.79146653000666e-05;-5.87361669501119e-05;-0.104328164786251;-0.104220343732480;0.458092174568001;-0.241162890151015;1.22475916913850;1.17237193987189;-0.000132310819002377;-0.0706672284137853;-8.43498775525066e-05;-2.53348506196452e-05;-0.272641029170843;-0.285419479809270;0.0301681204561396;0.0309312889079746;-0.0950657236189118;-0.0671888138044132;2.78186888186567e-05;0.285675466435339;-3.78479978227380e-05;7.55578539115594e-05;0.0180257818688266;0.0186408575266359;0.103930386754859;0*-0.000205230167931972;-0.00988591818525078;-0.00988777609217555;0.000143662123066486;0.158454277054005;3.64933878367109e-05]
Par=[0*0.0101926849193825;5.69719999860561e-07;5.54283227203015e-07;6.87302213739534e-05;0.00450875605363952;0.000654416042660232;0.000828405602360951;0.000237046536124109;3.66805521232113e-06;1.62231686020557e-05;-0.000141021313075437;1.63577653599714;1.59853995092999;0.00419595896090629;-0.00662387755804554;-0.130612247203286;-0.111853261678803;0.000224024209458336;0.122746984932263;8.63585621021760e-05;5.67097535030523e-05;-0.0400577320269192;-0.0326572969452761;0.593599306507624;0.896939006346081;-0.212678455751739;-0.226834425897614;9.10695003890415e-05;1.04573539853289;-0.000259465200648194;-0.000231294261761964;-0.136420643379768;-0.0740347344530010;0.453820658538245;-0.278866107645144;1.22074212719610;1.17411797028480;-0.00118021642331601;-0.0574873051692177;-0.000147525232015872;-0.000397611052486165;-0.239576877030147;-0.296424207055085;0.0364695213846264;0.0451448819869989;-0.111717002253468;-0.100111367932223;-2.37454576084467e-05;0.297119378239473;0.000155316835876828;-0.000405161285829800;0.0181588868863589;0.0226385227605529;0.112465742309701;-0.0106113324762842;-0.00807701124393468;-0.00569305634476049;2.76235539423216e-05;0.166330514289281;3.78321394974455e-05]
Par=[0,-0.000141021313075437,5.67097535030523e-05,-0.000231294261761964,-0.000397611052486165,-0.000405161285829800;5.69719999860561e-07,1.63577653599714,-0.0400577320269192,-0.136420643379768,-0.239576877030147,0.0181588868863589;5.54283227203015e-07,1.59853995092999,-0.0326572969452761,-0.0740347344530010,-0.296424207055085,0.0226385227605529;6.87302213739534e-05,0.00419595896090629,0.593599306507624,0.453820658538245,0.0364695213846264,0.112465742309701;0.00450875605363952,-0.00662387755804554,0.896939006346081,-0.278866107645144,0.0451448819869989,-0.0106113324762842;0.000654416042660232,-0.130612247203286,-0.212678455751739,1.22074212719610,-0.111717002253468,-0.00807701124393468;0.000828405602360951,-0.111853261678803,-0.226834425897614,1.17411797028480,-0.100111367932223,-0.00569305634476049;0,0.000224024209458336,9.10695003890415e-05,-0.00118021642331601,-2.37454576084467e-05,2.76235539423216e-05;3.66805521232113e-06,0.122746984932263,1.04573539853289,-0.0574873051692177,0.297119378239473,0.166330514289281;0,8.63585621021760e-05,-0.000259465200648194,-0.000147525232015872,0.000155316835876828,3.78321394974455e-05]

Par=[0;6.52358269531827e-07;5.56668537306576e-07;7.88844631532300e-05;0.00378945410700297;0.000697118491302526;0.000768242304634207;0;3.34714565876698e-06;0;6.49581595052207e-06;1.62101644629936;1.62509293235207;0.00850159671729343;8.14483595009705e-05;-0.137271273394326;-0.110419283165383;-0.00203812284947845;0.122838928229045;-7.37417708503493e-05;0.000239426224896767;-1.33751814574726e-05;-0.0255499191352488;0.600198924492308;0.883982395564273;-0.216775930966662;-0.215435971583474;0.000147454450390513;1.04328873162697;0.000403775331077999;-5.99874440157943e-06;-0.146004220654813;-0.000740387962650865;0.431458713807460;-0.260060386799904;1.21568264714162;1.19112464111263;-0.00707381991258575;-0.0373013307244046;-3.39833184355189e-05;0.000239170750334251;-0.256507014838907;-0.329299612884827;0.0545313840621097;0.0520300265340904;-0.104703863685868;-0.119254905447422;-2.51000346732550e-06;0.291961550792445;3.03029411811615e-05;-0.000377251335833572;0.0182865416262097;0.00822604313536458;0.123570343438582;-0.0392783323800937;-0.00915209109980891;7.86168386685068e-05;3.49581598082870e-08;0.154611577924684;7.11032341912381e-06]

Par=[0;8.61988053098464e-07;4.72642612023684e-07;0.000102842476446976;0.00257382647227852;0.000995995968910650;0.00111342897598234;0;3.31075202467479e-06;0;-1.42568533587030e-05;1.59513517738480;1.61524047708638;-0.00229835070404015;-0.000696982643570534;-0.133074984105968;-0.103331166771075;2.40249173348226e-06;0.113483586162182;-0.000464947001597911;0.000429819670301070;-3.84695731947399e-07;-0.0980615689956458;0.665648438149173;0.884516147216507;-0.253414710583426;-0.247868747693469;1.28710382256119e-05;0.963606293925493;-0.000887200861260698;-0.00341891700655665;-0.135963628023724;0.103121336010659;0.354851037764123;-0.192999898977186;1.21276413091753;1.14688371698547;-0.341188736580854;0.0334427482873057;-1.58485162801852e-07;0.000660513279155038;-0.285622047186048;-0.369751607433003;0.0740943043823069;0.0427665530877798;-0.132796220112956;-0.104474663934335;2.85668983556558e-06;0.306065902118540;-8.26734625713155e-05;2.41219292644870e-05;0.0355166147055138;0.0107764179474849;0.116488023636243;-0.0440110384288321;4.39407744888164e-07;2.61268243959879e-05;-4.44916685189705e-07;0.174152543815789;4.54491013881796e-05]

%presure on kinetic orders
Par=[0;1.17495805865635e-06;5.98608040071496e-07;0.000112343384657547;0.0128020666763683;0.00144425116370970;0.00244943744859591;0;4.05830375490384e-06;0;0.00517869090832019;1.53954008219557;1.57379294564694;-0.0147008151099786;0.0539129430914310;-0.161955636104317;-0.118651999355109;0.00183931022187270;0.107319975588872;-0.000143915002327760;-0.00618711458472641;0.000968494405526573;-0.191549633790929;0.711883013532270;0.819184144748304;-0.356131826889567;-0.198878875285741;0.00394511839156641;0.888933698649085;-0.00102494623086038;-0.000137777373444069;-0.112419452439279;0.185800346642068;0.323045799414790;-0.336515242014691;1.28032149913027;1.07254417706336;1.16186621327278e-06;0.0565839186450244;0.00293891967467746;-0.000146752806850095;-0.334089528930944;-0.449391591998566;0.0857569579203057;0.110509989145125;-0.149021028507581;-0.137751227559649;-0.0113270994824452;0.320601371095488;-0.0649279924366324;-0.0137001668217304;0.0905620956056977;0.0359873545694433;0.0799897200811330;-0.171518181302912;-0.000999138646419265;-0.000669923218417275;-0.000705337390825140;0.197598334396216;0.000354827368863223]

%no more presure
Par=[-4.63704377350494e-07;1.31394314862909e-06;8.04622874838038e-07;0.000113039701544313;0.0299244212386286;0.00156307830120998;0.00321441295485906;-2.06843955790359e-06;4.85495353447226e-06;6.85491091109349e-06;-0.00123448181736182;1.49349511041410;1.54542625358346;-0.0166393280071499;0.0220023005097678;-0.168521365281483;-0.134113863248125;0.00445930664182536;0.105107995478354;-0.000976523644116763;0.000962663511500810;-0.000999782734622306;-0.219915727562363;0.729928103096615;0.831978489218084;-0.394940878645884;-0.154740139300658;0.00340203559751087;0.846884693611356;-0.00690855740573136;0.000235465295397344;-0.0890657920540882;0.219705460386821;0.308262814146909;-0.445917185458030;1.29562861619072;1.01747280762457;0.00122008805897642;0.0635063605843028;0.00410169265303084;-0.0219528742475377;-0.363887411884545;-0.498474516436647;0.0942317576792690;0.133732073845444;-0.149745213779354;-0.131817401378328;-0.00835466412519780;0.330884796861898;0.000102920643154589;0.000560852901390676;0.137207258416360;0.0447837708405313;0.0694690405851239;-0.165686635187290;-0.000754892402330610;0.00402844379133731;-0.000149617183521900;0.208359941212510;-0.000640513344328422]
Par=[-1.85310341882358e-05;1.47317308944373e-06;9.00901925035121e-07;0.000107742204905220;0.0371088349493975;0.00152900221542094;0.00340009750839485;0.00388134435375383;5.23582397825262e-06;1.72976882770023e-07;-0.000110466293343899;1.46472823578196;1.53557464184975;-0.0168217233399870;0.0313732507019920;-0.169166822940307;-0.134709065669417;6.39439031615614e-05;0.102786788437165;0.00227470228649184;-0.000327445925521596;0.000802827189693818;-0.238641548001883;0.736563063266582;0.842110429077120;-0.382125657913992;-0.141397521297296;-0.00450118566021768;0.827069140764159;-0.000374061270240803;-1.31472629460622e-05;-0.0779206016823869;0.236129442159275;0.302241941898826;-0.501034323642772;1.28476909568058;0.997751183046873;0.00991973034370092;0.0687250367635868;-0.0287840015161746;0.000615474165480016;-0.382429163588013;-0.521285406235045;0.101363786226800;0.107443648599955;-0.148200440287427;-0.126633666795513;-0.00231927980069925;0.332952869012625;0.00118783338751013;-0.000457989541249043;0.164889896366864;0.0506561814158090;0.0677391958764059;-0.124517868756054;0.000997496642632983;0.00323694922415608;0.0112496918712278;0.216549136569427;1.16904843966262e-05]
Par=[8.30009239909546e-05;2.24680245615484e-06;1.28513764803377e-06;0.000114663705521096;0.337526797253012;0.00224273452529906;0.00425739519246560;0.888612544647416;6.15877728805338e-06;7.62636630394477e-05;0.0388944013332204;1.41108073063391;1.50933888217817;-0.0258145386231157;0.0918836491524394;-0.177846152675703;-0.134014607262342;0.000995955543614736;0.0960560366116183;-0.00325282414945774;-0.00147692324637421;-5.39949505640723e-07;-0.259318856126794;0.736182743207238;0.830979852145419;-0.400775429065761;-0.127257895610460;-0.000507088151000786;0.799770808462382;-0.00829383763103061;-0.0321949450450769;-0.0656638981476790;0.252420790705227;0.296573294442482;-0.739970888254615;1.26661812305624;0.964643837924714;-0.633913689781812;0.0798545449818176;0.00520989765521786;0.00123717613106544;-0.418478557568798;-0.564093600997483;0.103355192902392;0.152016531758205;-0.155786212124359;-0.137178213222892;0.0378779299395131;0.339636862591468;-0.000438139461724710;-0.00479711877322101;0.204643923212439;0.0721048270165598;0.0767876988357779;-0.238990543691367;-0.000651198569044349;0.0102717463231140;-0.0108991003717400;0.216958518747639;9.31442091608442e-05]
Par=[2.01000030504152e-07;6.17840285506539e-06;1.10639139995044e-06;0.000110159137086306;0.113546414312275;0.00453182677331608;0.00787946513524819;4184.60935960298;9.72354096343329e-06;7.45235374915438e-07;0.00201466862736885;1.35806851827259;1.47125608715638;-0.0413332815214503;0.125323151373965;-0.187986414879318;-0.133320369190795;-1.14194906409362e-05;0.0898636908657002;0.00309915005096666;0.00156599346524686;0.000988228141502511;-0.365654395951979;0.742112769922002;1.06197306096321;-0.434502556076263;-0.122077198374000;-0.360712897676352;0.781793251576705;-0.00229359872198341;-2.75543128480960e-06;-0.0728988179221552;0.307587158960334;0.279130397969031;-1.02311605949548;1.24529297006206;0.926938704087483;-1.31534844351156;0.0947342714712098;0.000277660614865001;-0.0157963545891748;-0.464600830019000;-0.546651910705414;0.110322407091817;0.249606169665868;-0.176750216887226;-0.160541997233235;0.114997474041835;0.315865039695119;-0.000108308488959499;0.0149524576062521;0.211847079455893;0.124749438313031;0.103162100471898;-0.169979149549653;0.000994970637311251;0.00130141249825413;-0.275524539554565;0.195649325612846;0.00364796436815905]

% %doesnt solve for feed bet 0 and 1
% Par=[0;1.17495805865635e-06;5.98608040071496e-07;0.000112343384657547;0.0128020666763683;0.00144425116370970;0.00244943744859591;0;4.05830375490384e-06;0;0.00517869090832019;1.53954008219557;1.57379294564694;-0.0147008151099786;0.0539129430914310;-0.161955636104317;-0.118651999355109;0.00183931022187270;0.107319975588872;-0.000143915002327760;-0.00618711458472641;0.000968494405526573;-0.191549633790929;0.711883013532270;0.819184144748304;-0.356131826889567;-0.198878875285741;0.00394511839156641;0.888933698649085;-0.00102494623086038;-0.000137777373444069;-0.112419452439279;0.185800346642068;0.323045799414790;-0.336515242014691;1.28032149913027;1.07254417706336;1.16186621327278e-06;0.0565839186450244;0.00293891967467746;-0.000146752806850095;-0.334089528930944;-0.449391591998566;0.0857569579203057;0.110509989145125;-0.149021028507581;-0.137751227559649;-0.0113270994824452;0.320601371095488;-0.0649279924366324;-0.0137001668217304;0.0905620956056977;0.0359873545694433;0.0799897200811330;-0.171518181302912;-0.000999138646419265;-0.000669923218417275;-0.000705337390825140;0.197598334396216;0.000354827368863223]
% Par=[1.03581850086469e-06;2.75331318217920e-06;1.06472447713271e-06;0.000116639429662146;0.0173399658238750;0.00243192849020759;0.00454823412645711;0.154672281024407;7.85697564547085e-06;-8.64726656990773e-08;0.00241379063868159;1.46439996606855;1.53260240465035;-0.0295564796346358;0.122355881957407;-0.212190346098610;-0.125346617461537;-8.21483666277657e-06;0.101004054619202;-0.000605016269630100;0.00893646315742510;1.53071662773142e-05;-0.240435794541310;0.741330846309259;0.863050901988179;-0.428884353743676;-0.158047515623139;-0.000377942372961383;0.826994335682673;1.53724538691912e-05;0.00463229553454297;-0.0991756505044523;0.237556532318254;0.302304465483667;-0.576184420355540;1.32461048143975;0.999375610653158;0.000379235197313349;0.0591370594633420;0.000209857225381517;-2.43452001825321e-05;-0.383911509328531;-0.526471335582392;0.0948702130883307;0.143772070378383;-0.159625791341269;-0.155150033832838;-0.0541633395435691;0.331868254395680;0.000887267296645160;-0.00100927947094762;0.123457921502731;0.0462740972218380;0.0797638452514857;-0.133989520444562;-0.000309356858726909;9.79409899216984e-05;-0.173978355620435;0.187866977113574;0.00211012212775387]
% 
% Par=[1.44057707311521e-06;2.72490469516899e-06;1.05058740786904e-06;0.000116047548376316;0.0164982025958848;0.00239717049578664;0.00450540401330926;0.0269629928642963;7.81240008722074e-06;4.86858514885173e-07;0.00111082063795143;1.46465493629467;1.53304131663241;-0.0294232698557217;0.120978389012062;-0.209784465802006;-0.125854594103435;0.000108810160881369;0.100950099175268;-0.000858813117156627;0.00965034666222149;2.80615846782312e-05;-0.239670513068388;0.740445430106346;0.866313174319778;-0.427057276183839;-0.156528023007343;-0.000456623814610492;0.826730084987609;2.48282003356013e-05;0.0117757695393851;-0.0988615281083805;0.237764626034739;0.302276221362496;-0.572566580498199;1.32430712433276;0.999467798849413;-0.000330507130565138;0.0593904585202851;0.000805371601236858;-8.29363184811181e-06;-0.383436094446148;-0.525555376136174;0.0951224117655661;0.138704565749364;-0.159350812407837;-0.155217399354852;-0.117703543438650;0.331242555670012;0.000653990722849563;-0.000493957320883880;0.123272823293690;0.0464305163692413;0.0795053218011325;-0.132867262126115;-0.000992378936907985;0.000184051885700238;-0.0878132801355469;0.187388692235593;0.00513608794461099]


% Par=Pars(:,183);


if size(Par)==[10,6] 
    Par=Par(:);end
lst_ODE_model(Par,1)
drawnow

% options = optimset('Display','iter','MaxFunEvals',5000,'MaxIter',5000);
% new_par=fminsearch(@lst_ODE_model,Par,options,0)
% lst_ODE_model(new_par,1)
% new_pp=reshape(new_par,10,6);

% % clear Lsts Pars
% new_par=Par;
% old_par=new_par;
% r=0;
% for n=190:350
%     %     new_par([1 8 10])=0;
%     options = optimset('Display','final','MaxFunEvals',5000,'MaxIter',5000);
%     new_par=fminsearch(@lst_ODE_model,new_par,options,0)
%     Lsts(n)=lst_ODE_model(new_par,1);
%     Pars(:,n)=new_par;
%     if new_par>old_par
%         r=r+0.01;
%         new_par=old_par*(1-r);
%         'new_par>old_par'
%     else
%         r=0;
%         old_par=new_par;
%     end
%     figure(100); plot(Lsts);title('SSwc')
%     drawnow
%     save('SSwc_v2')
% end

return

function z=lst_ODE_model(Par,g)
ok=0; 
Par(1:10)=abs(Par(1:10));

load('Met_Pathwayv2_S80000_P20000_Q20000_noDil')
temp=output(:,5);
output(:,5)=output(:,6);
output(:,6)=temp;

Tspan=0:100000;
options = odeset('RelTol',1e-6,'AbsTol',1e-6,'Events',@odeEvents);
tic
[t,y] = ode15s(@MetPathODE,Tspan,[80000 20000 20000 10 10],options,Par);
if or(t(end)<Tspan(end),any(imag(y)>0))
    ok=ok+1e12
end

if g==1
    figure(10)
    newcolors = [0.83 0.14 0.14
             1.00 0.54 0.00
             0.47 0.25 0.80
             0.25 0.80 0.54
             0.54 0.54 0.54];
         
         colororder(newcolors)
    plot(t,y, 'LineWidth', 1.5)
    hold on
    plot(output(:,1),output(:,2:end),'--', 'LineWidth', 1.5)
    hold off
    legend('S','P','Q','R','T')


end

dadosS=interp1(t,y,output(:,1));
lst=(dadosS-output(:,2:end)).^2;
lst(isnan(lst))=0;
lst1=sum(sum(lst));
%%

load('Met_Pathwayv2_S80000_P20000_Q20000_Dil0005In1.mat')
temp=output(:,5);
output(:,5)=output(:,6);
output(:,6)=temp;

Tspan=0:50000;
options = odeset('RelTol',1e-6,'AbsTol',1e-6);
[t,y] = ode15s(@MetPathODE_flow,Tspan,[80000 20000 20000 10 10],options,Par,[1 0.0005]);
if t(end)<Tspan(end)
    ok=ok+2e12
end

if g==1
    figure(11)
    newcolors = [0.83 0.14 0.14
             1.00 0.54 0.00
             0.47 0.25 0.80
             0.25 0.80 0.54
             0.54 0.54 0.54];
         
         colororder(newcolors)
    plot(t,y, 'LineWidth', 1.5)
    hold on
    plot(output(:,1),output(:,2:end),'--', 'LineWidth', 1.5)
    hold off
    
    assignin('base','output',output(1:2000:end,:))
assignin('base','ty',[t(1:500:end) y(1:500:end,:)])
end
 
dadosS=interp1(t,y,output(:,1));
lst=(dadosS-output(:,2:end)).^2;
lst(isnan(lst))=0;
lst2=sum(sum(lst));
%%

Tspan=0:50000;
options = odeset('RelTol',1e-6,'AbsTol',1e-6);
[t,y] = ode15s(@MetPathODE_flow,Tspan,[80000 20000 20000 10 10],options,Par,[.1 0.0005]);
if t(end)<Tspan(end)
    ok=ok+3e12
end
if g==1
    figure(12)
    newcolors = [0.83 0.14 0.14
             1.00 0.54 0.00
             0.47 0.25 0.80
             0.25 0.80 0.54
             0.54 0.54 0.54];
         
         colororder(newcolors)
    plot(t,y, 'LineWidth', 1.5)
    ylim([0 3000])
    if any(imag(y),'All')
        ok=ok+1e13
    end
     if any(std(y(20000:end,:))>2,'All')
         ok=ok+1e11
         [12 std(y(20000:end,:))]
     end
     
    
end
%%

Tspan=0:50000;
options = odeset('RelTol',1e-6,'AbsTol',1e-6);
[t,y] = ode15s(@MetPathODE_flow,Tspan,[80000 20000 20000 10 10],options,Par,[.5 0.0005]);
if t(end)<Tspan(end)
    ok=ok+4e12
end
if g==1
    figure(13)
    newcolors = [0.83 0.14 0.14
             1.00 0.54 0.00
             0.47 0.25 0.80
             0.25 0.80 0.54
             0.54 0.54 0.54];
         
         colororder(newcolors)
    plot(t,y, 'LineWidth', 1.5)
    ylim([0 3000])
   if any(imag(y),'All')
        ok=ok+1e13
    end
    if any(std(y(20000:end,:))>2,'All')
         ok=ok+1e11
         [13 std(y(20000:end,:))]
     end
end


%%
pp=reshape(Par,10,6);
lstp=abs(pp(:,2:6));
% lstp(lstp<=1e-3)=0;
p0s=sum(lstp<=1e-3);
lstp=sum(sum(lstp));
lstp=lstp/10^(floor(log10(lstp)))*10^(floor(log10(lst1))-1);

if g==1
    [lst1 lst2 lstp ok]
    p0s
end

z=lst1+lst2+lstp+ok;
end

function dxdt=MetPathODE(t,x,p) %This is the ODE function

pp=reshape(p,10,6);
pp(abs(pp)<1e-3)=0;
pp(:,1)=p(1:10);

PL=[pp(1:10)' x(1).^pp(11:20)' x(2).^pp(21:30)' x(3).^pp(31:40)' x(4).^pp(41:50)' x(5).^pp(51:60)'];
F=prod(PL,2);  

dxdt=[F(1)-F(2)
      F(3)-F(4)
      F(5)-F(6)
      F(7)-F(8)
      F(9)-F(10)];

end
function dxdt=MetPathODE_flow(t,x,p,flow) %This is the ODE function
in=flow(1);
dil=flow(2);

pp=reshape(p,10,6);
pp(abs(pp)<1e-3)=0;
pp(:,1)=p(1:10);

PL=[pp(1:10)' x(1).^pp(11:20)' x(2).^pp(21:30)' x(3).^pp(31:40)' x(4).^pp(41:50)' x(5).^pp(51:60)'];
F=prod(PL,2);  

dxdt=[in+F(1)-F(2)-x(1)*dil
      F(3)-F(4)-x(2)*dil
      F(5)-F(6)-x(3)*dil
      F(7)-F(8)-x(4)*dil
      F(9)-F(10)-x(5)*dil];

end
function [value,isterminal,direction] = odeEvents(t,y,Par,SSa)
x=toc-10;
if x<0
    x=0;
end

value = x;     % Detect height = 0
isterminal = 1;   % Stop the integration
direction = 0;   
end
% function dxdt=MetPathODE_flow(t,x,p,flow) %This is the ODE function
% in=flow(1);
% dil=flow(2);
% 
% FA=p(1)*x(1)/p(2)/(1+x(1)/p(2)+x(2)/p(3)+x(4)/p(4));
% FE=p(5)*x(2)/p(6)/(1+x(2)/p(6)+x(3)/p(7));
% FI=p(8)*x(3)/p(9)/(1+x(3)/p(9)+x(4)/p(10));
% FO=(p(11)*x(2)/p(12)+p(13)*(x(4)/p(14))*(x(2)/p(15)))/(1+x(2)/p(12)+x(5)/p(16)+(x(4)/p(14))*(1+x(2)/p(15)+x(5)/p(17)));
% 
% dxdt=[in-FA-x(1)*dil        %1 S
%        FA-FE-FO-x(2)*dil  %2 P
%        FE-FI-x(3)*dil     %3 Q
%        FI-x(4)*dil    %4 R
%        FO-x(5)*dil    %5 T
%        ];
% 
% end