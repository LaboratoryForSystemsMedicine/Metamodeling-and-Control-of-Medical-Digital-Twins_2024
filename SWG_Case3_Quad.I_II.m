% %original from v1 without distance
% Par=[-0.0517149756028689;-0.0465827340822360;-0.00810722354789016;0.0100494952535803;-0.349531939541116;-0.00180303228536999;0.390998940861039;-0.265106365171149;0.0258824659936809;3.90979432078804e-06;-7.77805518412944e-07;5.21372251962772e-07;2.56637987914373e-05;3.62205359831750e-05;-3.99087450107234e-08;0.000100474266080589;-4.92412405978976e-05;7.30788694256394e-06;1.17017535080366e-05;8.66823033885435e-08;2.38352039229626e-06;9.50898617595568e-05;-3.13703321100264e-05;-1.75133215293859e-05;4.14441962000353e-06;5.04654279908527e-06;-5.92803212623533e-06]
% 
% %v2
% Par=.95*[-0.0598542363949530;-0.0442068879433094;-0.00831865347884592;0.00504086785243646;-0.496498551044622;-0.00360957623149149;0.556369662260449;-0.162234552436476;0.000847325535173705;3.66701262355252e-06;-5.05669956236610e-07;3.44195146114616e-07;4.98293071773947e-05;0.000166222531557443;-4.11965201045858e-08;0.000170610744780600;-5.36852372775121e-05;-3.03076460372901e-07;9.09126411766703e-06;6.90940180816572e-08;2.76691374179777e-06;6.31767570851577e-05;-1.77023636013081e-05;-9.63000689474325e-06;-9.22968771614809e-07;5.48040546593550e-06;-6.08879109607712e-06]
% Par=[-0.0605481589968318;-0.0661449878494964;-0.00530761151084380;0.00226095173000410;-0.532536412907213;-0.00333088632678299;0.557608161126630;-0.147082476142578;0.000141727613870893;3.53297062855123e-06;-3.17486962077582e-07;3.52458459560727e-07;4.89119288817483e-05;0.000129876226271914;-4.73904753106648e-08;0.000158510071922360;-4.60888071461781e-05;-2.01311773784554e-07;1.16654523371331e-05;1.09350609196101e-07;2.34210637707048e-06;0.000215181942525516;-7.96332328713828e-06;-3.29564833085858e-06;3.36206791536473e-08;4.94688174220322e-06;-1.22897343510427e-06]
% 
% Par=[-0.0531680410249922;-0.0464706312973534;-0.00785451223377784;0.000133489352694774;-0.270427611528254;-0.00479917470584026;0.333916097071607;-0.227361444830694;0.0175969929695567]
% Par=[Par;zeros(18,1)];
% Par=[-0.0532493180595982;-0.0468191103722618;-0.00812387477197271;0.000132896104885935;-0.268459194524126;-0.00481289717527905;0.335357373339778;-0.225918598354458;0.0175486962797043;2.60049666615702e-06;2.21825020461662e-06;1.82325570006794e-07;2.03600101404298e-05;-2.34302634796392e-05;3.03823419009731e-07;3.62978377901276e-06;6.67201156952062e-05;-1.56314532506163e-06;9.11671609031064e-06;-5.27661593123376e-06;-5.02142697837515e-06;-4.66307188353278e-06;-3.73585606838808e-06;1.04624278824183e-05;6.86000337558445e-07;-4.88404287961431e-07;-5.04751750761579e-06]
% Par=[-0.0415106956714393;-0.0500123461638009;-0.00451318193393611;-0.000374683210334747;-0.406766078792115;0.00635833386583357;0.372537405198009;-0.313556775740047;0.00204572680259163;2.26968618548970e-06;1.59413035659869e-06;4.77716718642891e-07;1.63090586552193e-05;-0.000142401632292706;2.58122020279899e-06;1.38717823944355e-06;0.000291725524640513;-2.80716325759848e-06;7.44755617881055e-06;-5.25922660996888e-06;3.25923587094792e-06;-6.79384604336479e-06;-1.20615429338824e-05;1.21168174311722e-05;3.16624585658537e-07;-1.00320985924361e-06;1.96253311660193e-06]
% Par=[-0.0386061310552987;-0.0473087023008649;-0.00353970261140203;-0.000672091039795922;-0.415093485349354;0.00708582801341735;0.335153771686842;-0.324733337067520;-4.67718217050755e-05;1.97212726384683e-06;1.61365866191773e-06;4.57239288413966e-07;8.56328541970720e-06;-0.000150549232317021;1.93510318160039e-06;2.29782975541028e-06;0.000275078516813274;-2.69177288896152e-06;5.28622610580789e-06;-5.33205750591815e-06;3.06593879323372e-06;-3.05428237214035e-06;-1.51658109817824e-05;1.16661424982100e-05;3.30090819442773e-07;-8.94889784107862e-07;1.79843725998430e-06]
% 
% % Par=[-0.0530900056110979;-0.0463768007658385;-0.00784412502027986;0.000133398266880416;-0.270721030825774;-0.00479988409857203;0.335014472677387;-0.227222674113837;0.0176147209931258;4.03878714432319e-06;-3.02781250700073e-07;4.28855739097580e-07;4.19661707300312e-06;2.30309440279983e-05;3.36584017699326e-09;2.32648413194959e-05;-6.76435937432266e-06;1.79401443351184e-06;1.09033053856963e-05;-2.95746888540317e-06;1.20259757403817e-06;3.31884918374722e-05;4.52226153522911e-05;-5.54459489871180e-06;3.48327307311776e-06;5.24693637790606e-06;-2.52542281427281e-06]
% % Par=[-0.0485633578103414;-0.0419703717126153;-0.00814212217013495;0.00183576727524785;-0.277766414319422;-0.00293927137635091;0.319687739100045;-0.215925936190532;0.0181128529134119;4.07078341643445e-06;-3.48634228451350e-07;4.77764847684165e-07;8.99930042515510e-06;1.64935762894125e-05;-3.01300524780027e-09;5.22940891679623e-05;2.39227415759149e-05;6.50964310086960e-06;1.10349514619625e-05;6.30098346679878e-08;2.02271639938802e-06;6.73576289527179e-05;1.91381965951082e-05;-9.36667876731849e-06;5.43900422905734e-06;1.02745562099286e-05;-4.51465751069951e-06]
% % Par=[-0.0501964431131269;-0.0469217608506685;-0.00799201427160108;0.00378921253012706;-0.309791985153258;-0.00232602226075472;0.365459906168398;-0.178439673758807;0.0228046606712514;3.92786307269504e-06;-4.58918764846142e-07;5.15525927120649e-07;1.75411952094847e-05;2.87274067169565e-05;-5.78683247286643e-09;6.89691278599298e-05;6.45059792761150e-06;5.84427974670387e-06;1.13015955095135e-05;-1.24332779619512e-08;2.30891086309271e-06;5.24921942228429e-05;-1.21918733151700e-05;-1.69779938019767e-05;-1.24326078667619e-06;6.11968967926168e-06;-5.82985478639790e-06]
% Par=[-0.0517149756028689;-0.0465827340822360;-0.00810722354789016;0.0100494952535803;-0.349531939541116;-0.00180303228536999;0.390998940861039;-0.265106365171149;0.0258824659936809;3.90979432078804e-06;-7.77805518412944e-07;5.21372251962772e-07;2.56637987914373e-05;3.62205359831750e-05;-3.99087450107234e-08;0.000100474266080589;-4.92412405978976e-05;7.30788694256394e-06;1.17017535080366e-05;8.66823033885435e-08;2.38352039229626e-06;9.50898617595568e-05;-3.13703321100264e-05;-1.75133215293859e-05;4.14441962000353e-06;5.04654279908527e-06;-5.92803212623533e-06]
% 

%from Fig01
x=1.0e+04 *[2.4303    0.4184    0.1845]
p=[0.271534422167105;5.06439269612949e-06;3.54767246927118e-05;1.06349863925472e-06;0.0100168833738356;8.57919266464095e-06;1.79504478308065e-05;0.0751134696364733];
J=[p(1)-2*p(2)*x(1)-p(3)*x(2) -p(3)*x(1)  0
   p(4)*x(2) p(4)*x(1)-p(5)-p(6)*x(3) -p(6)*x(2)
   0 p(7)*x(3)  p(7)*x(2)-p(8)]
% 11 22 33 12 23 13
H=[-2*p(2)*0 0 0  -p(3) 0 0
   0 0 0 p(4) -p(6) 0
   0 0 0 0 p(7) 0]*0
Par=[J(:);H(:)]
% Par=[-0.124018575469901;0.00447923266233312;0.000157438605481327;-0.854774330694275;7.10220429708806e-07;0.0333297804241246;-1.32252906151348e-05;-0.0357342426585704;-8.91480563246423e-06;9.20761151979656e-07;8.31405385442157e-07;2.68149469813889e-07;-2.58830391030282e-06;-3.47578289172432e-06;8.35851140386983e-06;-1.38928753801091e-05;1.20123273901212e-06;1.73792727109156e-07;8.03508641590095e-06;6.15962554980517e-06;3.21115280868408e-06;-1.01976314541907e-05;1.79558324772030e-05;4.72855448812714e-06;4.52006389688109e-06;3.79655148131344e-06;-7.11334418112095e-07];
% Par=[-0.137467781964200;0.00488766607610326;0.00231296213719810;-0.737475176470661;-9.00762417957176e-06;0.0370605473307811;-0.000113779061320366;-0.0520197239834533;-3.99022541216169e-05;1.73831707985682e-06;7.65299187568897e-07;2.12786748186150e-08;1.03063424905284e-05;-2.68096732691215e-06;-6.30017771631166e-06;-6.28584608598861e-05;1.05139827619244e-05;-3.91383718097285e-07;9.02096602179684e-06;5.97168043811488e-06;-7.83360714103655e-07;4.22165912070818e-05;2.51354231094377e-05;1.97096015715043e-05;3.08650034445781e-05;5.27525403121619e-06;3.20625673631423e-06];
% Par=[-0.137270602639520;0.00496230685291272;0.00233758044148320;-0.720758845897706;1.64369857552675e-05;0.0378313907864567;-0.000165676023773458;-0.0538434762549995;-1.30503681973088e-05;1.79096362348902e-06;7.68143433888103e-07;2.98560759305641e-08;1.51467032339915e-05;-2.56534415993220e-06;-6.59149104552909e-06;-7.16764993063303e-05;1.33255177117458e-05;4.69980948914530e-08;8.93809298875499e-06;5.91015231106360e-06;-9.42601011031713e-07;5.29709966509461e-05;2.49330537910443e-05;2.34554364518664e-05;3.04775089576370e-05;4.97368678251233e-06;3.01550695476653e-06];
% Par=[-0.137609706313989;0.00424278828186469;0.00204775497261616;-0.712102746881149;0.000175376260931784;0.0365320832190795;-0.00563894239286057;-0.0457311108430390;0.000116729375031077;2.10913470989017e-06;7.64895064418570e-07;2.40066315595741e-09;2.53030622542548e-05;-2.18092333440734e-06;-4.26423715704614e-06;2.21877170660914e-05;1.69558722531407e-05;2.93151954293518e-07;9.42162198754017e-06;5.82801331800016e-06;-6.44289004875916e-07;6.31950277975125e-05;2.09930641099463e-05;3.00383361457669e-05;1.94777426690387e-05;4.17854659746422e-06;4.74514042971579e-06];
% Par=[-0.139195357908435;0.00372068882450285;0.00266759612491007;-0.689852380429445;0.000107778357898806;0.0387184951281223;-0.00622797774365913;-0.0480019018426034;0.00131355227862545;2.62943764659290e-06;7.48588521751637e-07;2.90059037623004e-10;1.71704669725887e-05;-1.57604017000598e-06;-1.31442887321772e-06;3.20500847012221e-05;1.43427226273407e-05;-5.27230503083780e-08;8.37020975473855e-06;5.87565821725502e-06;1.00126108315344e-07;3.65059033587038e-05;2.13749231978706e-05;1.95028816123231e-05;1.41689654849983e-05;5.11547985746775e-06;2.57794465247754e-06];
% Par=[-0.139172030397392;0.00372603510727997;0.00268943306457957;-0.689966660932480;0.000106937813302414;0.0386867707823950;-0.00630055095740825;-0.0482191680767072;0.00118029438069213;2.62822558924264e-06;7.48797630130087e-07;2.92865101087215e-10;1.71670501700129e-05;-1.58718427480488e-06;-1.32675827620599e-06;3.19859529569233e-05;1.44057461075553e-05;-5.28559097331682e-08;8.36832724206813e-06;5.87535844289474e-06;1.01620272903381e-07;3.67954633620016e-05;2.14122020433049e-05;1.94653998543258e-05;1.41637907383319e-05;5.10814954080726e-06;2.58754334582803e-06];
% Par=[-0.138955357970363;0.00380271785483123;0.00291635339400917;-0.683560118299944;3.77534932793313e-05;0.0392194187974285;-0.00959512396908146;-0.0502327205551016;0.00127738273259936;2.58837237562695e-06;7.48895109082416e-07;1.10917702833005e-10;1.84158549400450e-05;-1.73442873671541e-06;-1.50331808827036e-06;3.46508166189234e-05;1.41096015669899e-05;-1.62317502078202e-08;8.25667138766386e-06;5.86434288640884e-06;1.12873995623893e-07;4.03362611297813e-05;2.08346003394872e-05;2.07603916932312e-05;1.49230057843725e-05;5.09763417790491e-06;3.08858940867410e-06];
% Par=[-0.138948543002857;0.00380220900565140;0.00290495432089049;-0.683478797928865;3.95315178564909e-05;0.0391464627791276;-0.00982563910515703;-0.0502577053394001;0.00124621491485079;2.58972389599426e-06;7.48887903494193e-07;1.01761465835300e-10;1.84357719830214e-05;-1.73751354386965e-06;-1.49636673089897e-06;3.46937704070493e-05;1.41170078175997e-05;-1.57224147557765e-08;8.25504778692690e-06;5.86399069353849e-06;1.14002116702825e-07;4.00624144681278e-05;2.08039985611695e-05;2.07933649427214e-05;1.49167400410143e-05;5.08901470461816e-06;3.08252506153111e-06];
% Par=[-0.138948745368659;0.00380107046218690;0.00290396669692960;-0.683503384988481;4.03394304415303e-05;0.0391529289367004;-0.00991976634498333;-0.0502411036922711;0.00126155100457062;2.58965401251396e-06;7.48831986251382e-07;1.03341641515754e-10;1.84162632052026e-05;-1.73279411422826e-06;-1.48876611457748e-06;3.44672989363484e-05;1.40982244898084e-05;-1.58153489054445e-08;8.25533271575069e-06;5.86430645882671e-06;1.12857533047694e-07;3.99407621854866e-05;2.07698197519719e-05;2.07670844724593e-05;1.49028125919413e-05;5.08486263537083e-06;3.08869376986401e-06]
% 
% %v2.5
% Par=[-0.136122185501507;0.00470000527328765;0.00294312918969860;-0.723990652097058;5.08732344694062e-05;0.0516493315186855;0.0208856396282488;-0.0380229416820984;-0.000447495105544736;2.18673485671265e-06;7.64057560401103e-07;1.43031222094861e-10;3.81556195223351e-05;-4.38675661245459e-06;-2.10622346046862e-06;2.83350341598272e-06;8.83712992119584e-06;-2.38913669389489e-08;9.57497041697095e-06;5.98221458689609e-06;3.20384265587839e-07;3.57258834342047e-05;4.95196018812018e-06;2.35738153849727e-05;8.79086462891929e-06;2.97157604321549e-06;3.61614115872460e-07]
% Par=[-0.143375155322599;0.00523751100462844;0.00345050722599808;-0.701633463774255;-0.00115401410995800;0.0539744501388858;0.0105718679969639;-0.0396652253862461;-0.000315778486273778;2.11788336963034e-06;7.22262957749980e-07;-2.66339127383197e-10;4.10483164425040e-05;-4.17873717082524e-06;-5.84696256454206e-07;3.15582042161994e-05;1.63166588489359e-05;-4.67934361064604e-07;7.48964147124008e-06;6.08096718284091e-06;6.51320019766868e-07;-0.000178327524906865;-1.63829170797922e-05;3.49701491842982e-05;-1.70259567465513e-05;-9.43907273725178e-07;1.27668711790758e-06]
% Par=[-0.143439781370878;0.00518304179918267;0.00324019293491274;-0.697702545977149;-0.000513339017287714;0.0531671179453210;0.0355133560760720;-0.0326142095466527;0.000192948577266095;2.10914950831822e-06;7.14155851545031e-07;1.38172010945164e-09;4.31133574260798e-05;-4.00934446972270e-06;6.95024066272993e-07;2.95874378054674e-05;2.12398564458187e-05;1.61414723332623e-07;7.44537495599726e-06;6.08259317195467e-06;7.25528661913751e-07;-0.000111504481723563;-1.73301650109723e-05;3.47424073971872e-05;-4.81723364275999e-06;-1.75924616313775e-06;1.28379917802827e-06]
% Par=[-0.134807717575773;0.00604383038770301;0.00384798539468188;-0.697750545023038;0.000904419699209359;0.0498338811465794;0.00891622178864782;-0.0276402973177239;-8.50149870960170e-05;9.85716656563720e-07;6.83864730666294e-07;-4.14269679359940e-09;4.67989344781755e-05;-3.10869719727186e-06;2.62112942579447e-06;4.09467416625150e-06;2.26177804226359e-05;8.26522975985906e-09;6.32179032349594e-06;5.98225924167573e-06;7.29770813740400e-07;-0.000146181357543120;-3.62331252287310e-05;3.66646110051527e-05;-1.12007063984538e-06;-6.89000424913690e-06;2.93611771068184e-06]
% Par=[-0.134477520251914;0.00608688976392645;0.00381194617278594;-0.651913123997330;0.00106068789051445;0.0487171074937809;-0.00749080602779912;-0.0336220505304487;-8.59868257337276e-05;1.11741262736223e-06;6.88228910517721e-07;7.70103382361974e-09;4.89903685522171e-05;-3.06056245581964e-06;2.04603287932063e-06;9.89518367732184e-06;1.99919866554156e-05;3.58877737042716e-08;6.41603090981314e-06;5.86700291168477e-06;7.35930841978968e-07;-0.000122510398978923;-3.80067663669410e-05;3.73925833776477e-05;-1.57517265166720e-06;-6.81905650361412e-06;2.90180567618796e-06]
% Par=[-0.134510615562017;0.00616623703608131;0.00378253444021008;-0.627936869459208;0.00164218298484740;0.0485443810513820;0.0288645342035379;-0.0359746220642523;0.000241721413069965;1.17573042995374e-06;6.92213769927104e-07;8.27523600562423e-08;4.99601072466782e-05;-3.03921523020598e-06;5.70689131203515e-07;2.48495206250691e-05;1.58369720815730e-05;3.46777289995773e-07;6.37754408403555e-06;5.74138334900143e-06;7.97389451960325e-07;-0.000155558789063504;-3.71067422226989e-05;3.68038067967502e-05;-1.25120236409240e-05;-6.79168651462188e-06;3.03679752340765e-06]
% Par=[-0.131792286989823;0.00613032966829400;0.00374378780375043;-0.609486248719033;0.00152722608725431;0.0487605892227774;0.0596849014941818;-0.0363672500525343;0.000276954318184298;1.05271980125858e-06;6.98112792454501e-07;8.14251428135414e-08;5.21399704373572e-05;-3.06131105032796e-06;5.72338320809371e-07;5.33030484158216e-05;1.39233791753564e-05;3.80055710792621e-07;6.40842802785502e-06;5.72324567443433e-06;7.79882990800942e-07;-0.000156697191033769;-3.59869105889220e-05;3.71404049251682e-05;-1.38400827245550e-05;-6.76810244233716e-06;3.05624340193268e-06]
% Par=[-0.129583799784816;0.00627820778457679;0.00378603272281656;-0.613890857281863;0.00148937521356233;0.0494071808088439;0.0830017043629404;-0.0354693433392267;0.000279089363544886;8.25459413323845e-07;6.93226846729478e-07;9.73745126669951e-08;5.77992005283593e-05;-3.10040985985933e-06;3.60082046590085e-07;5.32290076209321e-05;1.32268060023656e-05;2.85267154051850e-07;6.56237771863958e-06;5.76801316264649e-06;7.87149410865842e-07;-0.000145979496969588;-3.62399205555706e-05;3.62846010081375e-05;-1.15036718872338e-05;-6.74735080612544e-06;3.07826337929789e-06]
% Par=[-0.129035738251663;0.00632601829325315;0.00373433796409941;-0.597124203090022;0.00220652636250568;0.0488143549423052;0.0874831708463893;-0.0345319439969162;0.000330096930337369;8.09500415602465e-07;6.97706847500802e-07;1.02716995346397e-07;5.84723925196616e-05;-3.02585228817813e-06;2.14409470324196e-07;5.75787779880825e-05;1.39698681877772e-05;3.46802383792615e-07;6.50792419160402e-06;5.72736636683956e-06;7.81969326867586e-07;-0.000144635260567241;-3.56782396476998e-05;3.61976464804188e-05;-1.25552327204832e-05;-6.78848173698218e-06;3.08180235028640e-06]

% Par=[-0.0517149756028689;-0.0465827340822360;-0.00810722354789016;0.0100494952535803;-0.349531939541116;-0.00180303228536999;0.390998940861039;-0.265106365171149;0.0258824659936809;3.90979432078804e-06;-7.77805518412944e-07;5.21372251962772e-07;2.56637987914373e-05;3.62205359831750e-05;-3.99087450107234e-08;0.000100474266080589;-4.92412405978976e-05;7.30788694256394e-06;1.17017535080366e-05;8.66823033885435e-08;2.38352039229626e-06;9.50898617595568e-05;-3.13703321100264e-05;-1.75133215293859e-05;4.14441962000353e-06;5.04654279908527e-06;-5.92803212623533e-06];

% Hes=[-0.0517149756028689;-0.0465827340822360;-0.00810722354789016;0.0100494952535803;-0.349531939541116;-0.00180303228536999;0.390998940861039;-0.265106365171149;0.0258824659936809;3.90979432078804e-06;-7.77805518412944e-07;5.21372251962772e-07;2.56637987914373e-05;3.62205359831750e-05;-3.99087450107234e-08;0.000100474266080589;-4.92412405978976e-05;7.30788694256394e-06;1.17017535080366e-05;8.66823033885435e-08;2.38352039229626e-06;9.50898617595568e-05;-3.13703321100264e-05;-1.75133215293859e-05;4.14441962000353e-06;5.04654279908527e-06;-5.92803212623533e-06]
Par=[-0.123052003310821;0.00445002788864124;0.000156893379254523;-0.861116107667374;7.13817679045148e-07;0.0331227739556887;-1.52253209912729e-06;-0.0359064076642960;-8.78901536597079e-06;-5.16483709859047e-07;7.78683351408063e-08;1.95479655740949e-08;4.69444950811225e-07;1.27300462110983e-07;-1.25366274318092e-07;2.93375088409385e-06;-1.86348368574318e-07;-1.75378598754169e-07;6.72870867353879e-06;1.69122009774982e-06;2.03893798010165e-07;7.83256797675990e-05;1.01462329564769e-05;-7.64212425038471e-07;-1.72761481770444e-07;1.83628195319240e-06;-1.16365955888558e-06]
Par=[-0.160760290556146;0.00701611671119370;0.000453010387672816;-0.608798736692350;2.97517303559378e-06;0.0193474765971843;-3.07826613832761e-06;-0.0680510001808264;-8.49857588822598e-07;2.90362084797921e-06;1.48497687341321e-07;-8.51911209453667e-08;-1.11370078456529e-06;1.24598530606086e-06;2.79293523632646e-07;-1.52180010464432e-06;-7.14472184724550e-07;-1.01674578631893e-06;-1.05585299652120e-05;3.65722728679852e-06;4.42971157688204e-07;-1.61262824140167e-05;-6.15475073891965e-06;1.68482847607039e-06;-3.62679380763189e-07;3.68335038805987e-06;-9.33453441828648e-07]
Par=[-0.157480962626959;0.00704751987606036;-0.000611887284221500;-0.598248145268082;8.24147957006338e-06;0.0148722971881940;-9.02894813734507e-06;-0.0704180185709875;7.76515493728275e-07;3.16465826229703e-06;1.47130639137662e-07;-4.40097827285390e-08;-7.09888481748566e-06;1.16900188311027e-06;2.63799816823151e-07;-3.59864109201160e-06;-1.82459502749679e-06;-1.22787874461126e-06;-8.36738732291953e-06;3.62968247715953e-06;3.72131159944533e-07;-1.30994768705092e-05;-2.42854373282788e-06;1.31232704683145e-06;1.02251531487329e-06;4.26066768464608e-06;-6.74103923509882e-07]




% close all
old_lst=lst_ODE_model(Par,1)
drawnow; pause(.1)
J=reshape(Par(1:9),3,3)
H=reshape(Par(10:27),3,6)
% 11 22 33 12 23 13
H1=[H(1,1) H(1,4) H(1,6);    H(1,4) H(1,2) H(1,5);    H(1,6) H(1,5) H(1,3)]
H2=[H(2,1) H(2,4) H(2,6);    H(2,4) H(2,2) H(2,5);    H(2,6) H(2,5) H(2,3)]
H3=[H(3,1) H(3,4) H(3,6);    H(3,4) H(3,2) H(3,5);    H(3,6) H(3,5) H(3,3)]
eig(J)
eig(H1)
eig(H2)
eig(H3)


% options = optimset('Display','iter','MaxFunEvals',5000,'MaxIter',5000);
% new_par=fminsearch(@lst_ODE_model,Par,options,0)
% new_lst=lst_ODE_model(new_par,1)
% old_lst
% J=reshape(new_par(1:9),3,3)
% H=reshape(new_par(10:27),3,6)
% % 11 22 33 12 23 13
% H1=[H(1,1) H(1,4) H(1,6);    H(1,4) H(1,2) H(1,5);    H(1,6) H(1,5) H(1,3)]
% H2=[H(2,1) H(2,4) H(2,6);    H(2,4) H(2,2) H(2,5);    H(2,6) H(2,5) H(2,3)]
% H3=[H(3,1) H(3,4) H(3,6);    H(3,4) H(3,2) H(3,5);    H(3,6) H(3,5) H(3,3)]
% eig(J)
% eig(H1)
% eig(H2)
% eig(H3)


return

function z=lst_ODE_model(Par,g)

ok=0;lst1=0;lst2=0;
lst4=0;lst5=0; lst6=0;

load('Dados01')
SS=mean(Ya(900:1000,:));

tic
Tspan=50:1000;
% options = odeset('RelTol',1e-6,'AbsTol',1e-6);     
options = odeset('RelTol',1e-6,'AbsTol',1e-6,'Events',@odeEvents);     
[t,y] = ode45(@ODE_SWG,Tspan,[Ya(Tspan(1),:) ],options,Par,SS);
if t(end)<Tspan(end)
    ok=ok+1e12
end
Yss=y(end,:);
if g==1
    newcolors = [0.25 0.80 0.54;0.7 0.7 0.7;0.83 0.14 0.14];
         
    
    figure(1)
    colororder(newcolors)
    plot(t,y, 'LineWidth', 1.5)
    
    hold on
    plot(Ta,Ya,'--', 'LineWidth', 1.5)
    hold off
    legend('grass','sheep','wolves')
%     y(end,:)
% [y]
% ewfwefwef

end
dadosS=interp1(t,y,Ta);
lst=(dadosS-Ya).^2;
lst(isnan(lst))=0;
lst1=sum(sum(lst));

load('Dados02')
Tspan=1051:2000;
tic
[t,y] = ode45(@ODE_SWG,Tspan,[Ya(Tspan(1),:)],options,Par,SS);
if t(end)<Tspan(end)
    ok=ok+1e12
end

if g==1
    figure(2)
    colororder(newcolors)
    plot(Ta(1000:end),Ya(1000:end,:),'--', 'LineWidth', 1.5)
    hold on
    plot(t,y, 'LineWidth', 1.5)
    hold off
    legend('grass','sheep','wolves')
    xlim([1000 2000])
%     y(end,:)
% y

end
if length(t)>10
    dadosS=interp1(t,y,Ta);
    lst=(dadosS-Ya).^2;
    lst(isnan(lst))=0;
    lst2=sum(sum(lst));
else
    lst2=1e12
end

if g==1
load('Dados03')
load('Dados03s')
Tspan=1000:2000;
     
[t,y] = ode45(@ODE_SWG_wC,Tspan,Yss,options,Par,SS);
if t(end)<Tspan(end)
    ok=ok+1e12
end


    figure(3)
    colororder(newcolors)
    plot(t,y, 'LineWidth', 1.5)
    hold on
    plot(Ta(1000:2000),Ya(1000:2000,:),'--', 'LineWidth', 1.5)
    plot(Ta(1000:2000),Ya(1000:2000,:)+3*Yas(1000:2000,:),'--', 'LineWidth', 1)
    plot(Ta(1000:2000),Ya(1000:2000,:)-3*Yas(1000:2000,:),'--', 'LineWidth', 1)
    
    hold off
    legend('grass','sheep','wolves')
    xlim([1000 2000])
%     y(end,:)
% y

dadosS=interp1(t,y,Ta);
lst=(dadosS-Ya).^2;
lst(isnan(lst))=0;
lst3=sum(sum(lst));
end

%%
% load('DadosConGrass2')
% load('DadosConGrass2s')
% Tspan=500:1500;
% tic
% options = odeset('RelTol',1e-6,'AbsTol',1e-6,'Events',@odeEvents2);         
% [t,y] = ode45(@ODE_SWG_wC2,Tspan,Ya(Tspan(1),:),options,Par,SS,[0.02 0 0]);
% if t(end)<Tspan(end)
%     ok=ok+1e12
% end
% 
% if g==1
%     figure(4)
%     colororder(newcolors)
%     plot(t,y, 'LineWidth', 1.5)
%     hold on
%     plot(Ta(500:1500),Ya(500:1500,:),'--', 'LineWidth', 1.5)
%     plot(Ta(500:1500),Ya(500:1500,:)+3*Yas(500:1500,:),'--', 'LineWidth', 1)
%     plot(Ta(500:1500),Ya(500:1500,:)-3*Yas(500:1500,:),'--', 'LineWidth', 1)
%     
%     hold off
%     legend('grass','sheep','wolves')
%     xlim([500 1500])
% end
% 
% dadosS=interp1(t,y,Ta);
% lst=(dadosS-Ya).^2;
% lst(isnan(lst))=0;
% lst4=sum(sum(lst));

%%
% load('DadosConSheep2')
% load('DadosConSheep2s')
% Tspan=500:1500;
%      
% [t,y] = ode45(@ODE_SWG_wC2,Tspan,Ya(Tspan(1),:),options,Par,SS,[0 0.02 0]);
% if t(end)<Tspan(end)
%     ok=ok+1e12
% end
% if sum(sum(y<0))>0
%     ok=ok+sum(sum(y<0))*1e8;
% end
% 
% if g==1
%     figure(5)
%     colororder(newcolors)
%     plot(t,y, 'LineWidth', 1.5)
%     hold on
%     plot(Ta(500:1500),Ya(500:1500,:),'--', 'LineWidth', 1.5)
%     plot(Ta(500:1500),Ya(500:1500,:)+3*Yas(500:1500,:),'--', 'LineWidth', 1)
%     plot(Ta(500:1500),Ya(500:1500,:)-3*Yas(500:1500,:),'--', 'LineWidth', 1)
%     
%     hold off
%     legend('grass','sheep','wolves')
%     xlim([500 1500])
% end
% 
% dadosS=interp1(t,y,Ta);
% lst=(dadosS-Ya).^2;
% lst(isnan(lst))=0;
% lst5=sum(sum(lst));

%%
% load('DadosConWolves1.5.mat')
% load('DadosConWolves1.5s.mat')
% Tspan=500:1500;
%      
% [t,y] = ode45(@ODE_SWG_wC2,Tspan,Ya(Tspan(1),:),options,Par,SS,[0 0 0.015]);
% if t(end)<Tspan(end)
%     ok=ok+1e12
% end
% 
% if g==1
%     figure(6)
%     colororder(newcolors)
%     plot(t,y, 'LineWidth', 1.5)
%     hold on
%     plot(Ta(500:1500),Ya(500:1500,:),'--', 'LineWidth', 1.5)
%     plot(Ta(500:1500),Ya(500:1500,:)+3*Yas(500:1500,:),'--', 'LineWidth', 1)
%     plot(Ta(500:1500),Ya(500:1500,:)-3*Yas(500:1500,:),'--', 'LineWidth', 1)
%     
%     hold off
%     legend('grass','sheep','wolves')
%     xlim([500 1500])
% end
% 
% dadosS=interp1(t,y,Ta);
% lst=(dadosS-Ya).^2;
% lst(isnan(lst))=0;
% lst6=sum(sum(lst));
%%

J=reshape(Par(1:9),3,3);
H=reshape(Par(10:27),3,6);

syms x y z
eqns = [J(1,:)*[x;y;z]+H(1,:)*[x^2;y^2;z^2;x*y;y*z;x*z] == 0, J(2,:)*[x;y;z]+H(2,:)*[x^2;y^2;z^2;x*y;y*z;x*z] == 0, J(3,:)*[x;y;z]+H(3,:)*[x^2;y^2;z^2;x*y;y*z;x*z] == 0 ];
vars = [x y z];
eqnr = [x > 0-SS(1), x < 60000-SS(1), y > 0-SS(2), y < 10000-SS(2), z > 0-SS(3), z < 7500-SS(3) ];
[solx, soly, solz] = solve([eqns eqnr],vars);
sol=vpa([solx, soly, solz]);
sol2=eval(sol+SS);
limites=sol2(:,1)>0&sol2(:,2)>0&sol2(:,3)>0&sol2(:,1)<60000&sol2(:,2)<10000&sol2(:,3)<7500;
nzeros=length(limites);

lst7=(nzeros-1)*1e10;


if g==1 disp([lst1 lst2 0 lst4 lst5 lst6 lst7]);end

z=lst1+lst2+lst4*0+lst5*0+lst6*0+lst7+ok;
end
function dxdt=ODE_SWG(t,x,p,ss) %Hes
K=255*255;

Pr=reshape(p(1:9),3,3);
H=reshape(p(10:27),3,6);

X=(x-ss');
X2=[(x(1)-ss(1))*(x(1)-ss(1))
   (x(2)-ss(2))*(x(2)-ss(2))
   (x(3)-ss(3))*(x(3)-ss(3))
   (x(1)-ss(1))*(x(2)-ss(2))
   (x(2)-ss(2))*(x(3)-ss(3))
   (x(1)-ss(1))*(x(3)-ss(3))];

dxdt=Pr*X+H*X2;



end
function dxdt=ODE_SWG_wC(t,x,p,ss) %Hes
K=255*255;

u=0;
if t>1500 u=.01; end

Pr=reshape(p(1:9),3,3);
H=reshape(p(10:27),3,6);

X=(x-ss');
X2=[(x(1)-ss(1))*(x(1)-ss(1))
   (x(2)-ss(2))*(x(2)-ss(2))
   (x(3)-ss(3))*(x(3)-ss(3))
   (x(1)-ss(1))*(x(2)-ss(2))
   (x(2)-ss(2))*(x(3)-ss(3))
   (x(1)-ss(1))*(x(3)-ss(3))];

dxdt=Pr*X+H*X2;

dxdt(3)=dxdt(3)-u*x(3);

end
function dxdt=ODE_SWG_wC2(t,x,p,ss,uu) %Hes

K=255*255;

u=[0 0 0];
if t>1000 u=uu; end

Pr=reshape(p(1:9),3,3);
H=reshape(p(10:27),3,6);

X=(x-ss');
X2=[(x(1)-ss(1))*(x(1)-ss(1))
    (x(2)-ss(2))*(x(2)-ss(2))
    (x(3)-ss(3))*(x(3)-ss(3))
    (x(1)-ss(1))*(x(2)-ss(2))
    (x(2)-ss(2))*(x(3)-ss(3))
    (x(1)-ss(1))*(x(3)-ss(3))];

dxdt=Pr*X+H*X2;

dxdt=dxdt-u'.*x;

end
function [value,isterminal,direction] = odeEvents(t,y,Par,SSa)
x=toc-10;
if x<0
    x=0;
end
value = x;     % Detect height = 0
isterminal = 1;   % Stop the integration
direction = 0;   
end
function [value,isterminal,direction] = odeEvents2(t,y,Par,SSa,uu)
x=toc-60;
if x<0
    x=0;
end
value = x;     % Detect height = 0
isterminal = 1;   % Stop the integration
direction = 0;   
end

% function dxdt=ODE_SWG(t,x,p) %PL
% 
% K=255*255;
% 
% 
% Pn=reshape(1:28,[7 4]);
% Pr(:,1)=p(Pn(:,1));
% Pr(:,2:4)=repmat([x(1) x(2) x(3)],7,1).^p(Pn(:,2:4));
% Pr=prod(Pr,2);
% 
% dxdt=[Pr(1)-Pr(2)
%       Pr(3)-Pr(4)-Pr(5)
%       Pr(6)-Pr(7)];
% 
% end
% function dxdt=ODE_SWG_wC(t,x,p) %PL
% 
% K=255*255;
% 
% u=0;
% if t>1500 u=.01; end
% 
% Pn=reshape(1:28,[7 4]);
% Pr(:,1)=p(Pn(:,1));
% Pr(:,2:4)=repmat([x(1) x(2) x(3)],7,1).^p(Pn(:,2:4));
% Pr=prod(Pr,2);
% 
% dxdt=[Pr(1)-Pr(2)
%       Pr(3)-Pr(4)-Pr(5)
%       Pr(6)-Pr(7)-u*x(3)];
% 
% 
% end
% function dxdt=ODE_SWG_wC2(t,x,p,uu) %PL
% 
% K=255*255;
% 
% u=[0 0 0];
% if t>1000 u=uu; end
% 
% Pn=reshape(1:28,[7 4]);
% Pr(:,1)=p(Pn(:,1));
% Pr(:,2:4)=repmat([x(1) x(2) x(3)],7,1).^p(Pn(:,2:4));
% Pr=prod(Pr,2);
% 
% dxdt=[Pr(1)-Pr(2)-u(1)*x(1)
%       Pr(3)-Pr(4)-Pr(5)-u(2)*x(2)
%       Pr(6)-Pr(7)-u(3)*x(3)];
% 
% 
% end