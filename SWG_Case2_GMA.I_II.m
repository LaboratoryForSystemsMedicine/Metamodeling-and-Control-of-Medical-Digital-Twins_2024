

Par=[0.271534422167105;5.06439269612949e-06;3.54767246927118e-05;1.06349863925472e-06;0.0100168833738356;8.57919266464095e-06;1.79504478308065e-05;0.0751134696364733]
Par=[3.6079e+03;0;3.54767246927118e-05;1.06349863925472e-06;0.0100168833738356;8.57919266464095e-06;1.79504478308065e-05;0.0751134696364733]

Par=[3103.16256846100;-0.00249042742745070;3.16242649221822e-05;1.34894947218148e-06;0.0144986046672089;9.61318512727303e-06;1.42374154198437e-05;0.0576167891146790]

Par=[3103.16256846100 0 0 0
    3.16242649221822e-05 1 1 0
    1.34894947218148e-06 1 1 0
    0.0144986046672089 0 1 0
    9.61318512727303e-06 0 1 1
    1.42374154198437e-05 0 1 1
    0.0576167891146790 0 0 1]
Par=Par(:);

Par=[1854.90422940972;1.62864392223647e-05;1.40956303804389e-06;0.00109022733968339;6.66412188736635e-06;2.31157863149903e-05;0.0642271240303045;-0.0106926893504794;1.00452437361919;1.04084543274422;-0.0127516582635446;-0.00783365073951756;0.0335856729801004;0.0207277978021068;-0.00815481298004145;0.983916651390374;0.878060002192602;1.24684572546629;1.14905187511496;0.969979891799961;0.00994518705829758;-0.0157190109875314;-0.000674061298203174;-0.00180901706767544;-0.00124207552483119;0.820123890776580;0.992727716885120;1.01025700050011]
Par=[1946.45580308541;2.64634067165036e-05;1.73303637325119e-06;0.00283499377728695;2.60430944782005e-06;1.49981533032757e-05;0.0761456171496104;-0.0587788911646160;1.01217601734249;1.05746339477174;0.0383192704166181;0.126735336108326;0.0501146808229885;0.0468709889924531;-0.0125930844035423;0.904151067511144;0.874989141322141;1.12629633290059;1.12774485328755;0.989040131488065;0.0288327594531026;0.0329360012045679;-0.00729954768413860;-0.0254168060584199;-0.00187158170663087;0.780375903667079;1.01702475591860;0.947559228419480]
Par=[1214.52737924181;2.64171488826483e-05;1.62503899965833e-06;0.00529381913786387;3.41912629173350e-06;1.18331454029283e-05;0.0944229734647153;-0.0750520503410231;1.03021411544669;1.02307662884979;-0.0671206605774410;0.0834881107877517;0.0352412143008139;0.0287979849908632;-0.00821961713321200;0.880869128056834;0.843342338144808;1.15394673384960;1.04322708423375;1.00964849537138;0.0377466018882252;0.0718432230274940;-0.0476193922746914;0.0801188886234018;0.000468210393162584;0.953158653823381;1.03754301798553;0.925341970550229]
Par=[1214.52737924181;2.64171488826483e-05;1.62503899965833e-06;0.00529381913786387;3.41912629173350e-06;1.18331454029283e-05;0.0944229734647153;-0.0750520503410231;1.03021411544669;1.02307662884979;-0.671206605774410;0.0834881107877517;0.0352412143008139;0.0287979849908632;-0.00821961713321200;0.880869128056834;0.843342338144808;1.15394673384960;1.04322708423375;1.00964849537138;0.0377466018882252;0.0718432230274940;-0.0476193922746914;0.0801188886234018;0.000468210393162584;0.953158653823381;1.03754301798553;0.925341970550229]

Par=[1148.94759811668;2.41746417447094e-05;1.52023611467464e-06;0.00543708651300211;4.59410900123350e-06;1.04607822077307e-05;0.0891418981737031;-0.0734671958172504;0.970756323630136;0.999618759360450;-0.893574138061324;0.0475413724347976;0.0388630304099847;0.0299821572948233;-0.00801290979760882;0.970440171092652;0.853236875019897;0.839953892434920;1.43591183950856;1.02463951506626;0.0332390212912795;0.0679936848274016;-0.0619580279730104;0.0855715304050720;0.000458901403672944;0.571342818269012;1.04282580539330;0.945397946049921]

Par=[1134.39236907914;2.47705951268767e-05;1.45164432051406e-06;0.0316648546042426;4.74003730189276e-06;1.06625549388740e-05;0.0915989779075376;-0.0762422140904879;0.973578726420300;0.996236004206135;-0.0109515271057456;0.0497428058949860;0.0405630218729695;0.0286872740106015;-0.0137432584759856;0.962663869186016;0.857758955390441;-0.0641505477757948;1.43800193224612;1.02482322377935;0.0332948343811913;0.0725423824291964;-0.0678121502050428;0.0940546084385987;-0.00320662128944591;0.564796838644289;1.04100730088652;0.946776061111315]
% Par=[1156.07559162846;2.63437454503021e-05;1.61103752263518e-06;-0.347398293315479;4.89033759491479e-06;1.01143792449834e-05;0.0852171409306471;-0.0786150460482313;0.982112730237021;0.971652456788271;0.116807735037681;0.0499380771856347;0.0401287531402143;0.0323423307154222;-0.0207074067374115;0.947774791823285;0.883262100228450;-0.157352054379292;1.43299971362098;1.02152170701991;0.0381167607253119;0.0768969287526880;-0.0748610328365499;0.0902574544489075;-0.00565307000184066;0.572826981781840;1.04917865987380;0.942434712213358]
% 
% Par=[1124.43787384311;2.77937340576182e-05;1.69320617618424e-06;-1.16185903013901;4.36602458345638e-06;9.40199377059415e-06;0.0809576303877933;-0.0727877043214414;0.987205381927191;0.972178560653710;-0.428990603298294;0.0509577501558120;0.0340485708080838;0.0325087808679511;-0.0193975198657528;0.944536022443074;0.867762168644744;0.730785489727784;1.45385042282377;1.03253051339258;0.0387564286647363;0.0771926814233140;-0.0796574277000280;0.0959151529180848;-0.0221254957399726;0.567080848262511;1.04794171850731;0.941765853546178]
% Par=[1079.21975545697;2.96858243161773e-05;1.72762174900655e-06;-3.41666000322963;4.76013709095108e-06;9.19675793981207e-06;0.0825161254884424;-0.0876581366489516;0.979399516556627;0.970471358963119;-0.572245078126810;0.0483460387720608;0.0390453391292688;0.0344678674135422;-0.0135196770501105;0.945437708300215;0.861401601594923;0.820130507916956;1.44235827339184;1.03563410338556;0.0351094827178219;0.0821027626855274;-0.0929708214858382;0.103820464021259;-0.118810631831865;0.570388778420439;1.04375257969020;0.943684698164388]
% Par=.99*[1033.34926794600;3.09701083473716e-05;1.81639703357380e-06;-5.41258534752273;4.77405204667218e-06;9.25801188625396e-06;0.0821016075305171;-0.0875176498359573;0.982072578877141;0.967058978567436;-0.575106636168019;0.0452581520116554;0.0404636327572723;0.0311421340153692;-0.0119516813695734;0.940691958200935;0.861295042439959;0.704661245464836;1.44197174874505;1.03334806704119;0.0349127015694284;0.0897031572485201;-0.0936804768106059;0.0997103327584064;8.39314745907233e-05;0.574696258646302;1.04147930530325;0.947566112408212]
% Par=[983.022093463486;3.31566313564761e-05;1.83794356779978e-06;-5.44523632342177;5.61926084625074e-06;9.53725692405868e-06;0.0889753771747946;-0.0793484505503981;0.984498566868850;0.967274749841900;-0.549276524333615;0.0407624272035437;0.0410896566398811;0.0296656922983249;-0.0113538639341216;0.932163265919100;0.861328880547183;0.701350691850085;1.42560851549056;1.02226934914452;0.0272942556272695;0.0876156794733783;-0.0935000232043853;0.0979606199919926;8.49408638581637e-05;0.579993515972638;1.04525213779245;0.943226419803873]
% 
% Par=[1050.97295204583;4.15447166100031e-05;1.78399332411772e-06;-46.2615280603589;9.19756940876979e-06;1.02803620826928e-05;0.0833205456439204;-0.117455491477881;0.992167871550450;0.927282737678906;-0.611213573488678;0.0167545120635593;0.0371387775888913;0.0241031335728876;-0.0295431873666821;0.921163546015285;0.907924912679694;0.617341614579174;1.41787034544486;1.02575740050018;0.0330019939296579;0.135827766678229;-0.136787363305612;0.105626293391931;-0.00117155132910121;0.568959724189270;1.02821301231359;0.945280021085237]
% Par=[1055.70140032001;3.92528034840900e-05;1.82751489872330e-06;-42.4765651922800;7.99609991218126e-06;1.06867124017334e-05;0.0869391936565869;-0.123015851271997;0.997751457491844;0.923268850451216;-0.740844407375688;0.0138634168167683;0.0386437125305254;0.0225229479091978;-0.0243761131386270;0.914995165875113;0.909531369198302;0.737955174787510;1.41537215664295;1.02233132380961;0.0255405236017775;0.132351281447467;-0.135125553823993;0.107858873389641;0.0112982108590492;0.589287597255509;1.02570972402934;0.951845721444331]
% Par=[1071.52608973025;4.21036563744878e-05;1.71137976733857e-06;-30.1299761774921;7.42102019579479e-06;1.03179254959531e-05;0.0872748201131433;-0.130369881427520;1.00019964159582;0.922897853432288;-0.725355999162799;0.00666857436976779;0.0410533504352195;0.0208399565434657;-0.0100052379263856;0.904352808648858;0.908847916117466;0.759097433051046;1.42587467405363;1.02190787500537;0.0212673105350188;0.131953214696072;-0.128405934764500;0.116230414468699;0.0395400683200598;0.598789516414672;1.02496083311683;0.956032183541361]

Par=[1123.92678996516;2.46215974558181e-05;1.41287578761394e-06;9.22804477591334e-06;4.70997170482698e-06;1.08152270243916e-05;0.0923129987417941;-0.0773128802214672;0.974670592127797;0.994201061527867;-0.0588043335041511;0.0493592997938601;0.0406352957106332;0.0278703407934810;-0.0131955536585885;0.961640793826341;0.862042108226421;0.596263092196166;1.44035568561986;1.02381542050737;0.0336292031639034;0.0740031498190315;-0.0679846938388007;0.0965327135608461;-0.0124444466242410;0.564679682133092;1.04101707003593;0.947281543507386]
Par=[1176.22994689130;2.45028199046998e-05;1.62620722053207e-06;-6.23511357415989e-05;4.47923448854371e-06;1.05637531185317e-05;0.0920261579557176;-0.0798461846466683;0.977542709357510;0.979764816251005;-0.898490518743227;0.0573021689647736;0.0459202264741979;0.0283731446189379;-0.0133929478797309;0.960101867545056;0.872548765440498;0.481352114049100;1.43309816826675;1.01726214154862;0.0334775027647687;0.0746803614344116;-0.0660149744077853;0.0864542696629566;-0.0178265630938904;0.569297592613505;1.04149278282705;0.944291242351523]
Par=[1043.17963182006;2.43854213466103e-05;1.86306559971200e-06;-0.000210035697492931;4.39901255841836e-06;1.08099517350170e-05;0.0927905558037431;-0.0822652475473813;0.980687102483213;0.979108051893706;-0.997585029353107;0.0556726751285649;0.0471811751928531;0.0272028159721966;-0.0139168609773331;0.959466540594562;0.856754800858372;0.512319760520315;1.43146301953092;1.01395238384168;0.0349479696670344;0.0861150510902845;-0.0775271930400929;0.0860176900133871;-0.0129083746770056;0.575829450675591;1.04048797312305;0.943066222984226]
Par=[1019.82706447518;2.66521346312999e-05;1.94475470036437e-06;-0.00565421522725986;4.17423036018926e-06;1.06072374948795e-05;0.0918345468923856;-0.0898025210363548;0.988636240705097;0.977387181261956;-0.948887860035764;0.0413112258692128;0.0468692378518216;0.0215696416658000;-0.00400011954839097;0.939605854338975;0.877531269767882;-18.9318749477876;1.44453543467484;1.01250283433034;0.0318193999541782;0.0965855103105217;-0.0705484956751807;0.0534274597656973;-0.0607766964008525;0.580194557271928;1.03906438288079;0.950563242784122]
Par=.99*[989.266373622558;2.53046492932740e-05;1.64728901582474e-06;-0.0108886866898946;4.19512179033707e-06;1.12293716938550e-05;0.0879456949611349;-0.0986187264430623;0.994065069903209;0.981093137637079;-1.38203385045566;0.0222303666849051;0.0437113841152166;0.0228691796619357;0.00261320316425573;0.938061119067436;0.878635541812255;-0.951480736865288;1.45671734933973;1.00919168813902;0.0317210238720504;0.0988058804419613;-0.0759583326103525;0.0704356777617935;-0.107990586208516;0.592639555717234;1.04137537563238;0.957006685046024]
Par=[965.159444189484;3.11350017606729e-05;1.58949956031680e-06;-0.0106141192816831;4.28762383622080e-06;1.12499336890787e-05;0.0977501671090627;-0.0905500284622063;0.995746711495251;0.981815119253860;-1.03002125281752;0.0226856153628632;0.0470083284866987;0.0146453425725651;0.00295949453063216;0.914459888024060;0.878972426830259;-0.973026969350179;1.43065101163751;1.00703915147860;0.0331917864689010;0.0978523274759579;-0.0728156419266349;0.0737231668805660;-0.0970572206959268;0.617774049818885;1.03645063874753;0.949777737124963]
% Par=[824.220600478686;3.27421244218740e-05;1.58743592698790e-06;0.0539739989724398;4.47811281142148e-06;1.14999868943387e-05;0.101999075668508;-0.0858600733713867;0.999583072813399;0.962707728214765;-1.05665122789873;0.00613873025357841;0.0463762750160094;0.0125687283342820;0.00276933146850418;0.917709730412372;0.915061088223451;1.04155783321262;1.44511755236926;1.00146272712151;0.0258579320670671;0.101107209871617;-0.0995332639564724;0.0614041675485721;-0.106735520560480;0.620022072585449;1.03747377034813;0.951621543827994]
% Par=[824.220600478686;3.27421244218740e-05;1.58743592698790e-06;0.0539739989724398;4.47811281142148e-06;1.14999868943387e-05;0.101999075668508;-0.0858600733713867;0.999583072813399;0.962707728214765;-1.05665122789873;0.00613873025357841;0.0463762750160094;0.0125687283342820;0.00276933146850418;0.917709730412372;0.915061088223451;1.04155783321262;1.44511755236926;1.00146272712151;0.0258579320670671;0.101107209871617;-0.0995332639564724;0.0614041675485721;-0.106735520560480;0.620022072585449;1.03747377034813;0.951621543827994]
Par=[951.599673165967;2.84054633726934e-05;1.50899412457475e-06;-0.0313327242751458;4.19879166731121e-06;1.12704343566477e-05;0.104988526799766;-0.0960505397212673;0.991004662966070;0.965138757050114;-0.998125500088131;0.0194636053656093;0.0444649390177782;0.0158883623154194;0.000974943160003281;0.938815999336413;0.902317545905890;0.991430049056124;1.43668162618240;1.00604356480506;0.0260816514381652;0.100436025071231;-0.0893843965399925;0.0826596791953813;-0.00232263628554842;0.624678239858205;1.03793242243689;0.942751591434483]
Par=[868.755664770158;2.70638806587325e-05;1.42483591405552e-06;0.948969158954893;3.05701917843518e-06;1.14537877727173e-05;0.114215686171417;-0.114933247401694;0.999142605346064;0.926991903213745;-0.938588191707146;-0.00848304680522891;0.0409990924065042;0.00880447858997871;0.0198125788804729;0.948459583536691;0.988094436403487;1.04353245526596;1.46339213387093;0.995241830999646;0.00437241152244230;0.131103228517689;-0.0902656832715641;0.0466261049039015;0.0897542090737495;0.672497354003440;1.03263741869959;0.945493280567542]

Par=[846.477592327693;2.79079886757208e-05;1.49106996424706e-06;8.00960076528845;2.94885060491583e-06;1.21052598122881e-05;0.120986278669478;-0.119395570695105;1.00018608280071;0.929175797742051;-0.995082635778267;-0.00234557805766516;0.0409841023987815;0.00977139565653563;0.0256026946051179;0.929750424008911;0.968132124749319;1.00986757043821;1.46269011871563;0.992495415653011;0.00150890282569934;0.126909274437645;-0.0829932882103131;0.0617674469959784;0.106155166664166;0.668523617437618;1.03694458224246;0.948544237361073]

Par=[831.371900855597;2.81279275345456e-05;1.47899992282382e-06;2.85486590262812;2.74301209504295e-06;1.20086116376052e-05;0.118432847589286;-0.121749931934825;1.00145528233197;0.927290835251788;-1.10201382368425;-0.00622197543184766;0.0402514382557020;0.00683622038923927;0.0335932398077381;0.927410039853752;0.967765570318258;0.842944419684512;1.46245822474967;0.991572945864702;0.00535752131054589;0.127389110388337;-0.0795002019887215;0.0633116026147636;0.695551991050972;0.671221570650377;1.03696191224102;0.948462448723283]
Par=[796.698764782417;2.67067196707539e-05;1.54323626989167e-06;4.81497143234526;2.62358136367843e-06;1.20975566815194e-05;0.119728140836132;-0.132470885066119;1.00342126515404;0.923692553651865;-0.980464515824788;-0.0113575013434131;0.0385680426985647;0.00446872913371756;0.0573154734556898;0.921458520816094;0.961827621534966;0.712264384575418;1.45819920867428;0.991165425936422;0.00703417876481017;0.127444582494161;-0.0629387842831152;0.0698622119255121;0.727889909573376;0.664189880047180;1.03695861474137;0.947368756899541]
Par=[702.273126672447;2.70730532387782e-05;1.16440854643648e-06;7.52793283633742;2.44673771572046e-06;1.09596938187894e-05;0.127701820523437;-0.131712701489947;1.00584360861033;0.938515070226944;-0.949250641903102;-0.00310257790446397;0.0378009267640091;0.00218864863389305;0.0658680258999700;0.923313978134636;0.991498585982555;0.661566321158342;1.46072451549572;0.996661219552699;0.00982585994580320;0.138810476428028;-0.0642037798137280;0.0587243284950527;0.724443969705820;0.650182857921185;1.03787569272024;0.930140566885902]

Par=[707.898797713976;2.74290709712722e-05;1.18449032179785e-06;7.63614372391576;2.47724294281499e-06;1.08954552559593e-05;0.129450032776724;-0.131322619148285;1.01002513278854;0.937497531445507;-0.940942480785047;-0.00313911396964099;0.0379856779311007;0.00216129790049945;0.0652059903326178;0.915235668006856;0.988680344035039;0.680196173029810;1.43529013066231;0.998693159011258;0.00973677896764006;0.138430231017208;-0.0624222334509402;0.0585716046376420;0.702043076249022;0.660600296309528;1.03520222002640;0.942070121122811]


% close all
lst_ODE_model(Par,1)
drawnow; pause(.1)

% options = optimset('Display','iter','MaxFunEvals',3000,'MaxIter',3000);
% new_par=fminsearch(@lst_ODE_model,Par,options,0)
% lst_ODE_model(new_par,1)
% z=reshape(new_par,[7 4]);
% zp=reshape(Par,[7 4]);
% % [[-0.0877   -0.0135    0.0821
% %     0.9794    0.9454   -0.0930
% %     0.9705    0.8614    0.1038
% %    -0.5722    0.8201   -0.1188
% %     0.0483    1.4424    0.5704
% %     0.0390    1.0356    1.0438
% %     0.0345    0.0351    0.9437] z(:,2:4)]
% % [[NaN,0,0;1,1,0;0,1,0;-1,1,0;0,1,1;0,0,1;0,-1,NaN] z(:,2:4)]
% [zp(:,2:4) z(:,2:4)]
% old=6.4146e+08

zp=reshape(Par,[7 4]);
double(int16(zp(:,2:4)*100))/100

return

function z=lst_ODE_model(Par,g)
Par(1:7)=abs(Par(1:7));
nzeros=sum(abs(Par(8:end))<=0.03);
Par(8:end)=Par(8:end).*(abs(Par(8:end))>0.03);
ok=0;lst1=0;lst2=0;
% Par([11 12 ])=0;

load('Dados01')
Tspan=50:1000;
options = odeset('RelTol',1e-6,'AbsTol',1e-6);     
[t,y] = ode45(@ODE_SWG,Tspan,[Ya(Tspan(1),:) ],options,Par);
if t(end)<Tspan(end)
    ok=1e12
end
Yss=y(end,:);
if g==1
    newcolors = [0.25 0.80 0.54;0.7 0.7 0.7;0.83 0.14 0.14];
         
    
    figure(1)
    colororder(newcolors)
    plot(t,y, 'LineWidth', 1.5)
    
    hold on
    plot(Ta,Ya,'--', 'LineWidth', 1.5)
    hold off
    legend('grass','sheep','wolves')
%     y(end,:)
% y
end
dadosS=interp1(t,y,Ta);
lst=(dadosS-Ya).^2;
lst(isnan(lst))=0;
lst1=sum(sum(lst));

load('Dados02')
Tspan=1051:2000;
     
[t,y] = ode45(@ODE_SWG,Tspan,[Ya(Tspan(1),:)],options,Par);
if t(end)<Tspan(end)
    ok=1e12
end

if g==1
    figure(2)
    colororder(newcolors)
    plot(Ta(1000:end),Ya(1000:end,:),'--', 'LineWidth', 1.5)
    hold on
    plot(t,y, 'LineWidth', 1.5)
    hold off
    legend('grass','sheep','wolves')
    xlim([1000 2000])
%     y(end,:)
% y
end
dadosS=interp1(t,y,Ta);
lst=(dadosS-Ya).^2;
lst(isnan(lst))=0;
lst2=sum(sum(lst));

if g==1
load('Dados03')
load('Dados03s')
Tspan=1000:2000;
     
[t,y] = ode45(@ODE_SWG_wC,Tspan,[ 2.4236    0.4001    0.1898]*1e4,options,Par);
if t(end)<Tspan(end)
    ok=1e12
end


    figure(3)
    colororder(newcolors)
    plot(t,y, 'LineWidth', 1.5)
    hold on
    plot(Ta(1000:2000),Ya(1000:2000,:),'--', 'LineWidth', 1.5)
    plot(Ta(1000:2000),Ya(1000:2000,:)+3*Yas(1000:2000,:),'--', 'LineWidth', 1)
    plot(Ta(1000:2000),Ya(1000:2000,:)-3*Yas(1000:2000,:),'--', 'LineWidth', 1)
    
    hold off
    legend('grass','sheep','wolves')
    xlim([1000 2000])
%     y(end,:)
% y

dadosS=interp1(t,y,Ta);
lst=(dadosS-Ya).^2;
lst(isnan(lst))=0;
lst3=sum(sum(lst));
end


lstl1=(reshape(Par,[7 4]));
lstl1=((lstl1(:,2:4))*1000).^2; %-[NaN,0,0;1,1,0;0,1,0;-1,1,0;0,1,1;0,0,1;0,-1,NaN]
lstl1(isnan(lstl1))=0;
lstl1=sum(sum(lstl1))*10;

if g==1 disp([lst1 lst2 lstl1]);end

z=lst1+lst2+lstl1+ok;
end
function dxdt=ODE_SWG(t,x,p) %This is the ODE function

K=255*255;


Pn=reshape(1:28,[7 4]);
Pr(:,1)=p(Pn(:,1));
Pr(:,2:4)=repmat([x(1) x(2) x(3)],7,1).^p(Pn(:,2:4));
Pr=prod(Pr,2);

dxdt=[Pr(1)-Pr(2)
      Pr(3)-Pr(4)-Pr(5)
      Pr(6)-Pr(7)];

end
function dxdt=ODE_SWG_wC(t,x,p) %This is the ODE function

K=255*255;

u=0;
if t>1500 u=.01; end

Pn=reshape(1:28,[7 4]);
Pr(:,1)=p(Pn(:,1));
Pr(:,2:4)=repmat([x(1) x(2) x(3)],7,1).^p(Pn(:,2:4));
Pr=prod(Pr,2);

dxdt=[Pr(1)-Pr(2)
      Pr(3)-Pr(4)-Pr(5)
      Pr(6)-Pr(7)-u*x(3)];


end